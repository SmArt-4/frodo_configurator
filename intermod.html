<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FPV Spectral Manager (MHz)</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; display: flex; justify-content: center; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 8px 30px rgba(0,0,0,0.1); width: 100%; max-width: 1000px; }
        
        .header-section { display: flex; gap: 20px; border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 20px; }
        .interest-box { background: #e8f4fd; padding: 15px; border-radius: 8px; border: 1px solid #b8daff; flex: 1; }
        .interest-inputs { display: flex; gap: 10px; margin-top: 5px; }
        
        .add-section { display: flex; gap: 10px; align-items: flex-end; margin-bottom: 20px; }
        .input-group { flex: 1; }
        label { display: block; margin-bottom: 5px; font-weight: 600; color: #444; font-size: 13px; }
        input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 15px; }
        
        .add-btn { padding: 10px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; color: white; white-space: nowrap; transition: opacity 0.2s; }
        .add-btn:hover { opacity: 0.9; }
        .btn-c1 { background: #007bff; } .btn-c2 { background: #6610f2; } .btn-c3 { background: #fd7e14; }

        .columns-container { display: flex; gap: 15px; }
        .column { flex: 1; background: #f8f9fa; border-radius: 8px; padding: 12px; min-height: 180px; border: 1px solid #e0e0e0; }
        .column h3 { margin-top: 0; font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 0.5px; }
        
        .freq-item { 
            background: #e9ecef; padding: 10px; margin-bottom: 8px; border-radius: 6px; 
            border: 2px solid transparent; display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; position: relative; transition: 0.2s;
        }
        .freq-item.active { background: white; border-color: currentColor; box-shadow: 0 4px 10px rgba(0,0,0,0.1); color: #000; }
        .del-btn { display: none; position: absolute; right: -8px; top: -8px; background: #dc3545; color: white; border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 10px; cursor: pointer; }
        .freq-item:hover .del-btn { display: block; }

        #results-area { margin-top: 25px; padding: 20px; border-radius: 8px; background: #fff; border: 1px solid #dee2e6; display: none; }
        .res-row { margin-bottom: 15px; padding: 12px; border: 1px solid #eee; border-radius: 8px; }
        .im-box { display: inline-block; padding: 8px; margin: 5px; border-radius: 4px; font-size: 13px; border-left: 4px solid; min-width: 220px; vertical-align: top;}
        .order3 { background: #fff5f5; border-color: #e74c3c; }
        .order2 { background: #f0f9ff; border-color: #3498db; }
        .harmonic { background: #fffaf0; border-color: #fd7e14; }
        
        .raw-output-section { margin-top: 30px; border-top: 2px dashed #ccc; padding-top: 20px; }
        .raw-box { background: #333; color: #00ff00; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 14px; min-height: 40px; word-break: break-all; }
        .range-text { font-weight: bold; font-family: monospace; color: #333; font-size: 14px; }
        small { color: #666; display: block; margin-top: 4px; }
    </style>
</head>
<body>

<div class="card">
    <div class="header-section">
        <div class="interest-box">
            <label>Observation Window (MHz)</label>
            <div class="interest-inputs">
                <input type="number" id="range_start" value="900" oninput="calculateAll()">
                <input type="number" id="range_end" value="6000" oninput="calculateAll()">
            </div>
        </div>
    </div>

    <div class="add-section">
        <div class="input-group">
            <label>Frequency (MHz)</label>
            <input type="number" id="freq_input" value="1280">
        </div>
        <div class="input-group">
            <label>Bandwidth (MHz)</label>
            <input type="number" id="bw_input" value="20">
        </div>
        <button class="add-btn btn-c1" onclick="addToCol(1)">+ Col 1</button>
        <button class="add-btn btn-c2" onclick="addToCol(2)">+ Col 2</button>
        <button class="add-btn btn-c3" onclick="addToCol(3)">+ Col 3 (Harmonics)</button>
    </div>

    <div class="columns-container">
        <div class="column" id="col1" style="border-top: 4px solid #007bff;"><h3>Intermod F1</h3></div>
        <div class="column" id="col2" style="border-top: 4px solid #6610f2;"><h3>Intermod F2</h3></div>
        <div class="column" id="col3" style="border-top: 4px solid #fd7e14;"><h3>Harmonics Only</h3></div>
    </div>

    <div id="results-area"></div>

    <div class="raw-output-section">
        <label style="font-weight: bold; font-size: 12px; color: #666;">RAW FILTERED RANGES</label>
        <div class="raw-box" id="raw-output"></div>
    </div>
</div>

<script>
    let lists = [[], [], []];

    function addToCol(n) {
        const f = parseFloat(document.getElementById('freq_input').value);
        const b = parseFloat(document.getElementById('bw_input').value);
        if (isNaN(f)) return;
        lists[n-1].push({ id: Date.now(), freq: f, bw: b, active: false });
        render();
    }

    function toggle(n, id) {
        const item = lists[n-1].find(i => i.id === id);
        if (item) item.active = !item.active;
        render();
    }

    function remove(e, n, id) {
        e.stopPropagation();
        lists[n-1] = lists[n-1].filter(i => i.id !== id);
        render();
    }

    function render() {
        const colors = ['#007bff', '#6610f2', '#fd7e14'];
        [1, 2, 3].forEach(num => {
            const container = document.getElementById(`col${num}`);
            container.innerHTML = `<h3>Col ${num}</h3>`;
            lists[num-1].forEach(item => {
                const div = document.createElement('div');
                div.className = `freq-item ${item.active ? 'active' : ''}`;
                div.style.color = item.active ? colors[num-1] : '#666';
                div.onclick = () => toggle(num, item.id);
                div.innerHTML = `<span><b>${item.freq}</b> <small>${item.bw}MHz BW</small></span><button class="del-btn" onclick="remove(event, ${num}, ${item.id})">X</button>`;
                container.appendChild(div);
            });
        });
        calculateAll();
    }

    function intersects(s1, e1, s2, e2) { return Math.max(s1, s2) <= Math.min(e1, e2); }

    function calculateAll() {
        const results = document.getElementById('results-area');
        const rawOutput = document.getElementById('raw-output');
        const active1 = lists[0].filter(i => i.active);
        const active2 = lists[1].filter(i => i.active);
        const active3 = lists[2].filter(i => i.active);
        const winS = parseFloat(document.getElementById('range_start').value);
        const winE = parseFloat(document.getElementById('range_end').value);

        if (active1.length === 0 && active2.length === 0 && active3.length === 0) { 
            results.style.display = 'none'; 
            rawOutput.innerText = '';
            return; 
        }

        let html = `<strong>Detected Products in Window (${winS}-${winE} MHz):</strong><br><br>`;
        let rawRanges = [];
        let found = false;

        // 1. Intermodulation Logic
        active1.forEach(o1 => {
            active2.forEach(o2 => {
                const f1 = o1.freq; const f2 = o2.freq;
                const bw1 = o1.bw; const bw2 = o2.bw;
                const products = [
                    { name: '3rd Order (2f1-f2)', c: Math.abs(2*f1-f2), w: (2*bw1)+bw2, cls: 'order3' },
                    { name: '3rd Order (2f2-f1)', c: Math.abs(2*f2-f1), w: (2*bw2)+bw1, cls: 'order3' },
                    { name: '2nd Order (f1+f2)', c: f1+f2, w: bw1+bw2, cls: 'order2' },
                    { name: '2nd Order (f1-f2)', c: Math.abs(f1-f2), w: bw1+bw2, cls: 'order2' }
                ];
                let mixHtml = '';
                products.forEach(p => {
                    const start = p.c - p.w/2;
                    const end = p.c + p.w/2;
                    if (intersects(start, end, winS, winE)) {
                        mixHtml += `<div class="im-box ${p.cls}"><b>${p.name}</b><br><span class="range-text">${start.toFixed(1)}-${end.toFixed(1)}</span></div>`;
                        rawRanges.push(`${Math.round(start)}-${Math.round(end)}`);
                    }
                });
                if (mixHtml) { found = true; html += `<div class="res-row"><strong>IM Mix: ${f1} & ${f2}</strong><br>${mixHtml}</div>`; }
            });
        });

        // 2. Harmonics Logic
        active3.forEach(o3 => {
            let harmHtml = '';
            for (let h = 2; h <= 10; h++) {
                const center = o3.freq * h;
                const width = o3.bw * h;
                const start = center - (width/2);
                const end = center + (width/2);
                if (intersects(start, end, winS, winE)) {
                    harmHtml += `<div class="im-box harmonic"><b>${h}th Harmonic</b><br><span class="range-text">${start.toFixed(1)}-${end.toFixed(1)}</span></div>`;
                    rawRanges.push(`${Math.round(start)}-${Math.round(end)}`);
                }
            }
            if (harmHtml) { found = true; html += `<div class="res-row"><strong>Harmonics: ${o3.freq}</strong><br>${harmHtml}</div>`; }
        });

        results.innerHTML = found ? html : "<em>No active products fall within the observation window.</em>";
        results.style.display = 'block';
        rawOutput.innerText = rawRanges.join(' ');
    }
</script>

</body>
</html>
